# Changelog

**重要**：本文件是项目变更的**唯一正式记录**。凡是项目的更新，都要统一在本文件里记录。这是项目管理的强制性要求。

格式基于 [Keep a Changelog](https://keepachangelog.com/zh-CN/1.1.0/)。

## [Unreleased]

### Added（新增）
- 新增 `src/buff.js`：Buff 掉落系统，敌机被击毁时 30% 概率掉落菱形 buff（速射/加速/护盾），玩家碰触后激活对应强化效果
- 新增 Buff 效果：⚡速射（射速提升 2.5x + 三线弹，持续 5s）、💨加速（移速提升 60%，持续 5s）、🛡护盾（完全免疫伤害，持续 3s）
- 新增左侧 HTML 侧边栏：存档面板（实时显示关卡/得分/生命/最高分/存档时间）+ 强化状态面板（buff 倒计时）+ 声音控制面板（开关 + 音量滑块）
- 新增 `SoundManager.unlock()`：在用户首次按键/点击时主动解锁 AudioContext，修复浏览器 autoplay policy 导致的无声音问题
- 新增 `SoundManager.buffPickup()`：buff 拾取音效（上扬双音）
- 新增 `SoundManager.setVolume()` / `toggle()`：支持运行时音量调节与静音切换，通过主 GainNode 统一控制

### Changed（变更）
- 修改 `src/player.js`：支持 buff 状态管理（`applyBuff`/`hasBuff`/`getActiveBuffs`），速射时机身变金色，护盾时显示紫色光晕，加速时显示青色光晕
- 修改 `src/sound.js`：引入主 GainNode 统一音量控制，所有音效路由经 masterGain 输出
- 修改 `index.html`：布局改为 flex row，左侧 160px 侧边栏 + 右侧 canvas，深色主题与游戏风格一致
- 修改 `src/main.js`：集成 BuffManager，每帧同步侧边栏状态，护盾期间跳过碰撞检测
- 修改 `AGENTS.md`：增加 `awesome-code` 协作规范（默认自决不反问）与交付前构建/冒烟验证门槛
- 新增"打飞机"纵向卷轴射击游戏实现：`src/main.js`、`src/player.js`、`src/enemy.js`、`src/bullet.js`、`src/ui.js`
- 新增 `src/sound.js`：基于 Web Audio API 的程序化音效系统（射击、爆炸、受击、通关、游戏结束）
- 新增 `src/save.js`：localStorage 存档管理器，支持进度保存/恢复/清除
- 新增通关机制：每关积累 500 分触发通关，暂停游戏并询问是否进入下一关（Enter/Space 继续）
- 新增存档机制：通关时自动保存进度，游戏结束时保留最高分，下次启动自动恢复
- 新增最高分显示（右下角 BEST 标签）
- 新增存档恢复 Toast 提示（启动时若有存档则显示 3 秒）

### Changed（变更）
- 更新 `index.html`：切换为加载 `src/main.js` 并使用单 Canvas（`#gameCanvas`）作为游戏渲染入口
- 更新 `README.md`：补充玩法/按键说明，并同步当前源码结构与架构说明

## [0.1.0] - 2026-02-19

### Added（新增）

- 将项目从通用项目转换为游戏项目
- 新增 `## 技术栈` 章节：定义 HTML5 Canvas、TypeScript、Vite 等技术栈
- 新增 `## 游戏开发规范` 章节：包含游戏主循环、实体组件设计、性能优化规范
- 定义游戏项目目录结构：src/game/、src/components/、src/utils/、src/assets/ 等

### Changed（变更）

- 修改 `## 项目目标`：从通用项目改为小游戏开发
- 修改 `## 核心工作流`：从通用流程改为游戏开发流程（游戏设计 → 原型实现 → 迭代优化 → 测试验证 → 发布）
- 修改 `## 工程原则`：新增帧率稳定原则，调整优先级为可玩性优先
- 修改 `## 目录结构`：更新为游戏项目结构
- 更新 `README.md`：添加游戏特性、快速开始、游戏架构说明

## [0.0.1] - 2026-02-19

### Added（新增）

- 初始化 AI 项目指令文件
- 生成 `CLAUDE.md`（Claude Code 项目指令）
- 生成 `AGENTS.md`（OpenAI Codex CLI 项目指令）
- 配置项目工程原则和工作流

### Changed（变更）

### Fixed（修复）

---

## 记录规范（强制性要求）

### 必须记录的变更类型

每次修改以下内容时，**必须**在本文件追加记录：

1. **项目指令文件变更**
   - CLAUDE.md 的任何修改
   - AGENTS.md 的任何修改

2. **项目结构变更**
   - 新增/删除/重命名目录
   - 新增/删除/重命名关键文件（如核心源码文件、配置文件）

3. **工作流变更**
   - 核心工作流程的调整
   - 开发流程的修改

4. **工程原则变更**
   - 新增工程原则
   - 修改或删除现有工程原则

5. **重要配置变更**
   - 影响项目行为的配置文件修改
   - 依赖关系的重大变更

### 记录格式

```markdown
## [版本号] - YYYY-MM-DD

### Added（新增）
- 新增了 XXX 功能/章节：用途是 YYY

### Changed（变更）
- 修改了 XXX 章节：原因是 YYY，具体变更内容是 ZZZ
- 修改了项目目录结构：将 ABC 目录移至 DEF 位置

### Fixed（修复）
- 修复了 XXX 问题：表现是 YYY，修复方式是 ZZZ

### Deprecated（即将弃用）
- XXX 功能将在下一版本移除：原因是 YYY

### Removed（已移除）
- 移除了 XXX 功能：原因是 YYY

### Security（安全）
- 修复了 XXX 安全漏洞：影响是 YYY
```

### 记录时机

- **修改前**：先在 `[Unreleased]` 部分草拟变更内容
- **修改后**：完善变更描述，添加具体细节和影响范围
- **发布时**：将 `[Unreleased]` 内容移至具体版本号下

### 版本号规则

遵循语义化版本（Semantic Versioning）：

- **主版本号（Major）**：重大架构变更、不兼容的 API 修改
- **次版本号（Minor）**：新增功能或章节，向后兼容
- **修订号（Patch）**：修复问题或微调，向后兼容

### 变更类型说明

| 类型 | 说明 | 示例 |
|------|------|------|
| Added | 新增的功能或章节 | "新增了 `## 变更记录规范` 章节" |
| Changed | 对现有功能或内容的变更 | "修改了 `## 工程原则` 章节，增加了早期返回原则" |
| Deprecated | 即将移除的功能（警告） | "旧的目录结构将在下个版本重构" |
| Removed | 已移除的功能 | "移除了已废弃的 `## 代码审查` 章节" |
| Fixed | 修复的问题 | "修复了模板中目录树生成的 bug" |
| Security | 安全相关的修复 | "修复了依赖包的安全漏洞" |

### 质量标准

每条记录应该：
- **清晰具体**：说明改了什么、为什么改
- **可追溯**：包含足够的上下文信息
- **格式统一**：遵循上述模板
- **及时更新**：修改后立即记录，不要拖延
