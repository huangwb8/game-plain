# game-plain - 项目指令

该目录用于 小游戏开发与维护。

## 项目目标

开发一个基于 Web 技术的小游戏，提供有趣的游戏体验。

本工作区的核心目标是构建一个简洁、可玩性强的游戏应用。

## 核心工作流

当用户提出游戏开发相关需求时，按以下流程执行：

### 任务理解

- 理解用户的真实需求和意图（游戏机制、视觉效果、交互方式）
- 确认任务范围和预期输出
- 识别可能的依赖和约束

### 执行流程

游戏设计 → 原型实现 → 迭代优化 → 测试验证 → 发布

### 输出规范

- 代码变更应遵循项目现有风格
- 游戏逻辑应清晰、可测试
- 用户体验应流畅、响应及时
- 文档更新应保持一致性

## 技术栈

本项目采用以下技术栈：

| 层级 | 技术 | 说明 |
|------|------|------|
| 运行时 | HTML5 Canvas / WebGL | 游戏渲染 |
| 语言 | TypeScript / JavaScript | 游戏逻辑 |
| 样式 | CSS / Tailwind | UI 样式 |
| 构建 | Vite / esbuild | 开发与打包 |

## 工程原则

本项目遵循以下工程原则：

| 原则 | 核心思想 | 在本项目中的体现 |
|------|----------|------------------|
| **KISS** | Keep It Simple, Stupid | 游戏机制简洁明了，避免过度复杂的设计 |
| **YAGNI** | You Aren't Gonna Need It | 只实现当前需要的游戏功能 |
| **DRY** | Don't Repeat Yourself | 游戏组件和逻辑应复用 |
| **SOLID** | 面向对象设计五大原则 | 游戏实体、系统分离 |
| **关注点分离** | Separation of Concerns | 渲染、逻辑、输入分离 |
| **帧率稳定** | Stable Framerate | 游戏主循环保持 60 FPS |
| **早期返回原则** | Early Return | 尽早返回，减少嵌套 |

**原则冲突时的决策优先级**：
1. **可玩性 > 一切**
2. **性能 > 灵活性**
3. **简洁性 > 复杂性**
4. **用户体验 > 开发便利**

## 默认语言

除非用户明确要求其他语言，始终使用 简体中文 与用户对话与撰写文档/说明。

## 联网与搜索

默认优先使用项目内文件与本地上下文；确需联网获取信息时，优先使用本地搜索工具。仅当本地工具不足以满足需求时再使用其它联网手段，并说明原因与保留关键链接。

## 目录结构

```
game-plain/
├── src/                    # 源代码目录
│   ├── main.ts            # 入口文件
│   ├── game/              # 游戏核心逻辑
│   │   ├── Game.ts        # 游戏主类
│   │   ├── Entity.ts      # 游戏实体基类
│   │   └── systems/       # 游戏系统（渲染、输入、物理等）
│   ├── components/        # UI 组件
│   ├── utils/             # 工具函数
│   └── assets/            # 静态资源（图片、音频等）
├── public/                # 公共资源
├── index.html             # 入口 HTML
├── package.json           # 项目配置
├── tsconfig.json          # TypeScript 配置
├── vite.config.ts         # Vite 配置
├── AGENTS.md              # 项目指令（本文件）
├── CLAUDE.md              # Claude Code 适配
├── README.md              # 项目说明
└── CHANGELOG.md           # 变更记录
```

## 游戏开发规范

### 游戏主循环

```typescript
// 标准游戏主循环结构
function gameLoop(timestamp: number) {
  const deltaTime = timestamp - lastTime;
  lastTime = timestamp;

  update(deltaTime);  // 更新游戏状态
  render();           // 渲染画面

  requestAnimationFrame(gameLoop);
}
```

### 实体组件设计

- 使用 ECS（Entity-Component-System）模式或简化版本
- 每个实体应有清晰的职责
- 组件应可复用、可组合

### 性能优化

- 避免在游戏循环中创建新对象
- 使用对象池管理频繁创建销毁的对象
- 合理使用 requestAnimationFrame
- 注意内存泄漏

## Codex CLI 特定说明

### 文件引用规范

在 Codex CLI 中引用文件时：
- 使用内联代码使文件路径可点击：`src/main.ts`
- 每个引用应有独立路径，即使是同一文件
- 包含相关的起始行号：`src/main.ts:42`
- 不要输出你刚写的大文件内容，只引用路径

### 代码编辑规范

- 高效、连贯的编辑：读取足够上下文后再修改文件，将逻辑相关的编辑批量处理
- 保持类型安全：变更应始终通过构建检查
- 无效输入早返回：遵循仓库中的日志/通知模式

### 输出格式

- 对于简单确认，跳过繁重格式
- 不要输出刚写的大文件，只引用路径
- 提供简短的逻辑后续步骤（测试、提交、构建）

## 变更边界

- 仅修改与当前任务直接相关的文件
- 不主动添加用户未要求的功能
- 保持现有代码风格和结构

## 变更记录规范

**重要原则**：凡是项目的更新，都要统一在 `CHANGELOG.md` 文件里记录。

### 记录范围

每次修改以下内容时，必须更新 CHANGELOG.md：
- **项目指令文件**：CLAUDE.md、AGENTS.md 的任何修改
- **项目结构变更**：新增/删除/重命名目录或关键文件
- **工作流变更**：核心工作流程的调整
- **工程原则变更**：新增、修改或删除工程原则
- **重要配置变更**：影响项目行为的配置文件修改
- **游戏功能变更**：新增、修改或删除游戏功能

### 记录格式

遵循 [Keep a Changelog](https://keepachangelog.com/zh-CN/1.1.0/) 格式：

```markdown
## [版本号] - YYYY-MM-DD

### Added（新增）
- 新增了 XXX 功能/章节：用途是 YYY

### Changed（变更）
- 修改了 XXX 章节：原因是 YYY，具体变更内容是 ZZZ

### Fixed（修复）
- 修复了 XXX 问题：表现是 YYY，修复方式是 ZZZ
```

### 记录时机

- **修改前**：先在 CHANGELOG.md 的 `[Unreleased]` 部分草拟变更内容
- **修改后**：完善变更描述，添加具体细节和影响范围
- **发布时**：将 `[Unreleased]` 内容移至具体版本号下

## 版本号管理规范

**核心原则**：项目的版本号统一通过 package.json 管理（Single Source of Truth），确保版本信息的一致性和可追溯性。

### 版本号命名规则

遵循 [语义化版本](https://semver.org/lang/zh-CN/) 规范：

| 版本类型 | 格式 | 使用场景 |
|---------|------|----------|
| **稳定版** | `v1.0.0` 及以上 | 游戏已稳定可玩 |
| **开发中** | `v0.x.x` | 功能开发中，可能有较大变更 |
| **实验性** | `v0.0.x` | 早期实验阶段，API 不稳定 |

版本号格式：`主版本号.次版本号.修订号`
- **主版本号**：不兼容的 API 修改或游戏重大改版
- **次版本号**：向下兼容的功能性新增（新关卡、新角色等）
- **修订号**：向下兼容的问题修正（Bug 修复）

### 版本号更新时机

| 变更类型 | 版本更新示例 | 说明 |
|---------|-------------|------|
| Bug 修复 | `1.0.0` → `1.0.1` | 修复问题，不改变功能 |
| 新增功能 | `1.0.0` → `1.1.0` | 向下兼容的新功能（新关卡、新角色） |
| 破坏性变更 | `1.0.0` → `2.0.0` | 不兼容的 API 变更或游戏重制 |

## 有机更新原则

当需要更新本文档时：

### 理解意图

首先理解用户需求背后的意图和在工作流中的本质作用

### 定位生态位

每条规则/要求都应找到其在整个文档结构中的"生态位"——它与其他内容的关系、它服务的目标、它影响的其他部分

### 协调生长

更新一个部分时，检查并同步更新相关部分：
- 更新工作流步骤时，同步更新示例和验证清单
- 更新输出规范时，同步更新引用该规范的其他章节
- 更新术语定义时，全局统一替换
- **更新本文档时，必须同步更新 CHANGELOG.md**
- **更新本文档后，确保 CLAUDE.md 的核心内容保持一致**
- 保持文档格式规范：层级标题不使用序号前缀（用 `##` 而非 `## 1)`），因为 Markdown 本身有层级结构

### 保持呼吸感

文档应该像生物体一样有"呼吸感"——章节之间有逻辑流动，而非割裂的清单

### 定期修剪整合

当某个章节变得过于臃肿时，主动重构

---

**提示**：修改本文档后，请立即在 `CHANGELOG.md` 中记录变更，并确保 `CLAUDE.md` 的核心内容保持一致。这是项目管理的强制性要求，不是可选项。
